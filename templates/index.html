<!DOCTYPE html>
<html>
<head>
    <title>Sludge Emptying Time Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        label { display: block; margin-top: 10px; }
        input, select, button { padding: 5px; margin-top: 5px; }
        .hidden { display: none; }
        #result { margin-top: 20px; font-weight: bold; }
    </style>
    <script>
        function toggleShapeFields() {
            let shape = document.getElementById("shape").value;
            document.getElementById("rectangular-fields").classList.add("hidden");
            document.getElementById("circular-fields").classList.add("hidden");

            if (shape === "rectangular") {
                document.getElementById("rectangular-fields").classList.remove("hidden");
            } else if (shape === "circular") {
                document.getElementById("circular-fields").classList.remove("hidden");
            }
        }

        async function calculate() {
            const data = {
                last_date: document.getElementById("last_date").value,
                P: document.getElementById("P").value,
                q: document.getElementById("q").value,
                F: document.getElementById("F").value,
                S: document.getElementById("S").value,
                shape: document.getElementById("shape").value,
                length: document.getElementById("length")?.value,
                width: document.getElementById("width")?.value,
                depth: document.getElementById("depth")?.value,
                diameter: document.getElementById("diameter")?.value
            };

            let response = await fetch("/calculate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            });

            let result = await response.json();
            if (result.error) {
                document.getElementById("result").innerHTML = `<span style="color:red">${result.error}</span>`;
            } else {
                document.getElementById("result").innerHTML = `
                    Volume: ${result.volume_litres} L<br>
                    Target Volume (2/3): ${result.target_volume} L<br>
                    A (24h retention): ${result.A} L<br>
                    Years until full: ${result.N_years}<br>
                    Next Emptying Date: ${result.next_emptying_date}
                `;
            }
        }
    </script>
</head>
<body>
    <h1>Sludge Emptying Time Calculator</h1>
    <label>Last emptying date: <input type="date" id="last_date"></label>
    <label>No. of people using pit (P): <input type="number" id="P" step="1"></label>
    <label>q (sewage flow per person per day, L): <input type="number" id="q" step="0.01"></label>
    <label>F (digestion factor): <input type="number" id="F" step="0.01"></label>
    <label>S (sludge accumulation rate, L/person/year): <input type="number" id="S" step="0.01"></label>

    <label>Shape:
        <select id="shape" onchange="toggleShapeFields()">
            <option value="">Select</option>
            <option value="rectangular">Rectangular</option>
            <option value="circular">Circular</option>
        </select>
    </label>

    <div id="rectangular-fields" class="hidden">
        <label>Length (m): <input type="number" id="length" step="0.01"></label>
        <label>Width (m): <input type="number" id="width" step="0.01"></label>
        <label>Depth (m): <input type="number" id="depth" step="0.01"></label>
    </div>

    <div id="circular-fields" class="hidden">
        <label>Diameter (m): <input type="number" id="diameter" step="0.01"></label>
        <label>Depth (m): <input type="number" id="depth" step="0.01"></label>
    </div>

    <br>
    <button onclick="calculate()">Solve</button>
    <div id="result"></div>
</body>
</html>
