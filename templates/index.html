<!DOCTYPE html>
<html>
<head>
    <title>Sludge Emptying Time Calculator</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select { margin-bottom: 10px; padding: 5px; width: 300px; }
        button { padding: 8px 16px; }
        #result { margin-top: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h2>Sludge Emptying Time Calculator</h2>

    <label>Last emptying date: </label>
    <input type="date" id="last_date"><br>

    <label>No. of people using pit (P): </label>
    <input type="number" id="P" step="0.01"><br>

    <label>q (sewage flow per person per day, L): </label>
    <input type="number" id="q" step="0.01"><br>

    <label>F (digestion factor): </label>
    <input type="number" id="F" step="0.01"><br>

    <label>S (sludge accumulation rate, L/person/year): </label>
    <input type="number" id="S" step="0.01"><br>

    <label>Shape: </label>
    <select id="shape" onchange="toggleShapeFields()">
        <option value="rectangular">Rectangular</option>
        <option value="circular">Circular</option>
    </select><br>

    <div id="rectangular_fields">
        <label>Length (m): </label>
        <input type="number" id="length" step="0.01"><br>
        <label>Width (m): </label>
        <input type="number" id="width" step="0.01"><br>
        <label>Depth (m): </label>
        <input type="number" id="depth" step="0.01"><br>
    </div>

    <div id="circular_fields" style="display:none;">
        <label>Diameter (m): </label>
        <input type="number" id="diameter" step="0.01"><br>
        <label>Depth (m): </label>
        <input type="number" id="circular_depth" step="0.01"><br>
    </div>

    <button onclick="calculate()">Solve</button>

    <div id="result"></div>

    <script>
        function toggleShapeFields() {
            let shape = document.getElementById("shape").value;
            document.getElementById("rectangular_fields").style.display = (shape === "rectangular") ? "block" : "none";
            document.getElementById("circular_fields").style.display = (shape === "circular") ? "block" : "none";
        }

        async function calculate() {
            let shape = document.getElementById("shape").value;
            let payload = {
                last_date: document.getElementById("last_date").value,
                P: document.getElementById("P").value,
                q: document.getElementById("q").value,
                F: document.getElementById("F").value,
                S: document.getElementById("S").value,
                shape: shape
            };

            if (shape === "rectangular") {
                payload.length = document.getElementById("length").value;
                payload.width = document.getElementById("width").value;
                payload.depth = document.getElementById("depth").value;
            } else {
                payload.diameter = document.getElementById("diameter").value;
                payload.depth = document.getElementById("circular_depth").value;
            }

            let response = await fetch("/calculate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            let result = await response.json();
            if (result.error) {
                document.getElementById("result").innerHTML = `<span style="color:red;">Error: ${result.error}</span>`;
            } else {
                document.getElementById("result").innerHTML = `
                    Volume of pit: ${result.volume_litres} L<br>
                    Target volume (2/3 full): ${result.target_volume} L<br>
                    A (Liquid retention): ${result.A} L<br>
                    B (Sludge & scum storage): ${result.B} L<br>
                    Check (A + B): ${result.check_sum} L<br>
                    N (years until 2/3 full): ${result.N_years} years<br>
                    Next emptying date: ${result.next_emptying_date}
                `;
            }
        }
    </script>
</body>
</html>
